<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ruleta Zero Shake</title>
<style>
  body {
    margin: 0;
    font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .card {
    background: rgba(255,255,255,0.03);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,0.1);
    padding: 40px;
    width: 380px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    text-align: center;
    position: relative;
  }

  h1 {
    margin: 0 0 10px;
    font-size: 24px;
    background: linear-gradient(135deg, #00d9ce, #00a89e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  p {
    font-size: 14px;
    opacity: 0.9;
  }

  input {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.05);
    margin-top: 20px;
    font-size: 14px;
    outline: none;
    color: #fff;
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  input::placeholder {
    color: rgba(255,255,255,0.4);
  }

  button {
    margin-top: 18px;
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    background: #ffffff;
    color: #0a0a0a;
    cursor: pointer;
    transition: all .2s ease;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255,255,255,.2);
  }

  .wheel-container {
    position: relative;
    margin: 25px auto;
    width: 260px;
    height: 260px;
  }

  .wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 8px solid #00d9ce;
    box-shadow: 
      0 8px 32px rgba(0,217,206,0.3),
      inset 0 0 40px rgba(0,0,0,0.1),
      0 0 60px rgba(0,217,206,0.15);
    position: relative;
    transition: transform 4s cubic-bezier(.17,.67,.26,1);
    background: conic-gradient(
      from 0deg,
      #0a0a0a 0deg 72deg,
      #1a1a1a 72deg 144deg,
      #2d2d2d 144deg 216deg,
      #1f1f1f 216deg 288deg,
      #252525 288deg 360deg
    );
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .wheel::after {
    content: '';
    position: absolute;
    width: 70px;
    height: 70px;
    background: radial-gradient(circle, rgba(10,10,10,0.98) 0%, rgba(10,10,10,0.85) 100%);
    border-radius: 50%;
    border: 2px solid #d4af37;
    box-shadow: 
      0 0 15px rgba(212,175,55,0.3),
      inset 0 0 15px rgba(0,0,0,0.5);
    z-index: 5;
  }
  
  .lion-logo {
    position: absolute;
    width: 52px;
    height: 52px;
    z-index: 6;
    filter: drop-shadow(0 2px 8px rgba(0,217,206,0.2));
  }

  /* Premios centrados en cada segmento */
  .wheel span {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 0% 0%;
    text-align: center;
    font-weight: 600;
    font-size: 10px;
    pointer-events: none;
    line-height: 1.3;
    width: 70px;
    margin-top: -8px;
    margin-left: -5px;
    color: #ffffff;
    text-shadow: 
      0 2px 8px rgba(0,0,0,0.5);
    letter-spacing: 0.8px;
    text-transform: uppercase;
    opacity: 0.95;
  }
  
  .wheel span::before {
    content: attr(data-icon);
    display: block;
    font-size: 16px;
    margin-bottom: 2px;
    filter: drop-shadow(0 1px 3px rgba(0,0,0,0.4));
  }

  /* Cada texto rotado seg√∫n su segmento (72¬∞ cada uno) */
  .wheel span:nth-child(2) { 
    transform: rotate(40deg) translateX(70px) rotate(-90deg);
  }
  .wheel span:nth-child(3) { 
    transform: rotate(106deg) translateX(56px) rotate(-90deg);
  }
  .wheel span:nth-child(4) { 
    transform: rotate(182deg) translateX(52px) rotate(-90deg);
  }
  .wheel span:nth-child(5) { 
    transform: rotate(254deg) translateX(50px) rotate(-90deg);
  }
  .wheel span:nth-child(6) { 
    transform: rotate(338deg) translateX(50px) rotate(-90deg);
  }

  .needle {
    position: absolute;
    top: 50%;
    left: -25px;
    transform: translateY(-50%) rotate(-90deg);
    width: 0;
    height: 0;
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-top: 50px solid #00d9ce;
    z-index: 10;
    filter: drop-shadow(0 0 15px rgba(0,217,206,0.8));
  }

  .result {
    margin-top: 20px;
    font-size: 16px;
    font-weight: 600;
    min-height: 24px;
  }
  
  .loading {
    display: inline-block;
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .small {
    margin-top: 10px;
    font-size: 12px;
    opacity: 0.7;
  }

</style>
</head>
<body>

<div class="card">
  <h1>üé∞ Ruleta Zero Shake</h1>
  <p>Ingresa tu c√≥digo y gira la ruleta</p>

  <input id="codigo" placeholder="Ej: ZS-DEMO-01">
  <button onclick="girar()">Girar ruleta</button>

  <div class="wheel-container">
    <div class="needle"></div>
    <div class="wheel" id="wheel">
      <svg class="lion-logo" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <radialGradient id="maneGrad">
            <stop offset="30%" stop-color="#00e5d4"/>
            <stop offset="100%" stop-color="#00a89e"/>
          </radialGradient>
          <linearGradient id="faceGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#fff5e6"/>
            <stop offset="100%" stop-color="#e8dcc8"/>
          </linearGradient>
        </defs>
        
        <!-- Melena turquesa realista -->
        <path d="M60 20 C50 22 42 28 38 35 C34 32 30 33 28 37 C26 41 28 46 32 50 C28 53 26 58 28 63 C30 67 34 68 38 66 C36 72 38 78 42 82 C45 85 50 84 54 81 C54 86 56 90 60 92 C64 90 66 86 66 81 C70 84 75 85 78 82 C82 78 84 72 82 66 C86 68 90 67 92 63 C94 58 92 53 88 50 C92 46 94 41 92 37 C90 33 86 32 82 35 C78 28 70 22 60 20 Z" 
              fill="url(#maneGrad)" opacity="0.95"/>
        
        <!-- Mechones de melena -->
        <g opacity="0.6" stroke="#00b5a8" stroke-width="2" fill="none" stroke-linecap="round">
          <path d="M42 28 C40 32 38 36 38 40"/>
          <path d="M50 24 C48 28 46 32 46 36"/>
          <path d="M70 24 C72 28 74 32 74 36"/>
          <path d="M78 28 C80 32 82 36 82 40"/>
          <path d="M34 52 C32 56 32 60 34 64"/>
          <path d="M86 52 C88 56 88 60 86 64"/>
        </g>
        
        <!-- Orejas -->
        <ellipse cx="45" cy="42" rx="6" ry="8" fill="#d4c4a8"/>
        <ellipse cx="75" cy="42" rx="6" ry="8" fill="#d4c4a8"/>
        <ellipse cx="45" cy="42" rx="3" ry="4" fill="#d4af37" opacity="0.4"/>
        <ellipse cx="75" cy="42" rx="3" ry="4" fill="#d4af37" opacity="0.4"/>
        
        <!-- Cara -->
        <ellipse cx="60" cy="58" rx="18" ry="22" fill="url(#faceGrad)"/>
        
        <!-- Hocico -->
        <ellipse cx="60" cy="68" rx="12" ry="10" fill="#f5ead8"/>
        
        <!-- Nariz -->
        <ellipse cx="60" cy="66" rx="5" ry="4" fill="#3a3a3a"/>
        <ellipse cx="60" cy="65" rx="3" ry="2" fill="#1a1a1a"/>
        
        <!-- Cejas -->
        <path d="M48 50 Q50 48 53 49" stroke="#4a4a4a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M72 50 Q70 48 67 49" stroke="#4a4a4a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        
        <!-- Ojos -->
        <ellipse cx="52" cy="54" rx="4" ry="5.5" fill="#2a2a2a"/>
        <ellipse cx="68" cy="54" rx="4" ry="5.5" fill="#2a2a2a"/>
        <ellipse cx="53" cy="53" rx="2" ry="3" fill="#ffffff"/>
        <ellipse cx="69" cy="53" rx="2" ry="3" fill="#ffffff"/>
        <circle cx="53.5" cy="55.5" r="1" fill="#00d9ce"/>
        <circle cx="69.5" cy="55.5" r="1" fill="#00d9ce"/>
        
        <!-- L√≠nea nariz a boca -->
        <line x1="60" y1="70" x2="60" y2="74" stroke="#3a3a3a" stroke-width="2" stroke-linecap="round"/>
        
        <!-- Boca -->
        <path d="M60 74 Q52 76 48 74" stroke="#3a3a3a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        <path d="M60 74 Q68 76 72 74" stroke="#3a3a3a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
        
        <!-- Bigotes -->
        <g opacity="0.7" stroke="#c4a76f" stroke-width="1.5" stroke-linecap="round">
          <line x1="42" y1="62" x2="32" y2="60"/>
          <line x1="42" y1="65" x2="32" y2="66"/>
          <line x1="42" y1="68" x2="32" y2="72"/>
          <line x1="78" y1="62" x2="88" y2="60"/>
          <line x1="78" y1="65" x2="88" y2="66"/>
          <line x1="78" y1="68" x2="88" y2="72"/>
        </g>
        
        <!-- Acentos dorados -->
        <g opacity="0.75" stroke="#d4af37" stroke-width="2.5" fill="none" stroke-linecap="round">
          <path d="M34 40 Q32 44 32 48"/>
          <path d="M86 40 Q88 44 88 48"/>
          <path d="M32 58 Q30 62 32 66"/>
          <path d="M88 58 Q90 62 88 66"/>
        </g>
      </svg>
      
      <span data-icon="‚óà">10% OFF</span>
      <span data-icon="‚ü°">BATIDO GRATIS</span>
      <span data-icon="‚¨°">UPGRADE PROTE√çNA</span>
      <span data-icon="‚óá">2X1</span>
      <span data-icon="‚úï">SIGUE CUID√ÅNDOTE</span>
    </div>
  </div>

  <div class="result" id="resultado"></div>
  <div class="small">1 c√≥digo = 1 giro</div>
</div>

<script>
  const WEBHOOK_URL = "https://flpzz.app.n8n.cloud/webhook-test/ruleta-validar";
  
  const premiosMap = {
    "10% OFF": 0,
    "BATIDO GRATIS": 1,
    "UPGRADE PROTE√çNA": 2,
    "2X1": 3,
    "SIGUE CUID√ÅNDOTE": 4
  };

  const codigosUsados = {};

  async function girar() {
    const input = document.getElementById("codigo").value;
    const codigo = input.toUpperCase().trim();
    const wheel = document.getElementById("wheel");
    const resultado = document.getElementById("resultado");
    const boton = document.querySelector("button");

    if (!codigo) {
      resultado.innerText = "‚ö†Ô∏è Ingresa un c√≥digo";
      return;
    }

    if (codigosUsados[codigo]) {
      resultado.innerText = "üö´ Este c√≥digo ya fue usado en esta sesi√≥n";
      return;
    }

    // Deshabilitar bot√≥n y mostrar loading
    boton.disabled = true;
    boton.style.opacity = "0.6";
    resultado.innerHTML = '<span class="loading">üîÑ Verificando c√≥digo...</span>';

    try {
      // Enviar c√≥digo al webhook
      const response = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ codigo: codigo })
      });

      const data = await response.json();

      if (!data.ok) {
        // C√≥digo inv√°lido o ya utilizado
        resultado.innerText = data.message || "‚ùå C√≥digo inv√°lido o ya utilizado";
        boton.disabled = false;
        boton.style.opacity = "1";
        return;
      }

      // C√≥digo v√°lido - obtener el premio desde n8n
      const premioRecibido = data.premio;
      const indicePremio = premiosMap[premioRecibido];

      if (indicePremio === undefined) {
        resultado.innerText = "‚ö†Ô∏è Error: Premio no reconocido";
        boton.disabled = false;
        boton.style.opacity = "1";
        return;
      }

      // Limpiar mensaje de verificaci√≥n
      resultado.innerText = "";

      // Calcular rotaci√≥n para que caiga en el premio espec√≠fico
      const centrosSegmentos = [40, 106, 182, 254, 338];
      const anguloDelPremio = centrosSegmentos[indicePremio];
      let rotacionNecesaria = 180 - anguloDelPremio;
      
      const vueltas = 5 + Math.floor(Math.random() * 3);
      const anguloFinal = vueltas * 360 + rotacionNecesaria;
      
      wheel.style.transform = `rotate(${anguloFinal}deg)`;
      codigosUsados[codigo] = premioRecibido;

      // Mostrar resultado despu√©s de la animaci√≥n
      setTimeout(() => {
        if (premioRecibido === "SIGUE CUID√ÅNDOTE") {
          resultado.innerText = `üíö ¬°Sigue intent√°ndolo! No te rindas`;
        } else {
          resultado.innerText = `üéâ ¬°Ganaste: ${premioRecibido}!`;
        }
        boton.disabled = false;
        boton.style.opacity = "1";
      }, 4200);

    } catch (error) {
      console.error("Error al validar c√≥digo:", error);
      resultado.innerText = "‚ö†Ô∏è Error de conexi√≥n. Intenta de nuevo";
      boton.disabled = false;
      boton.style.opacity = "1";
    }
  }
</script>

</body>
</html>
